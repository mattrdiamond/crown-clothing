{"ast":null,"code":"import firebase from \"firebase/app\";\nimport \"firebase/firestore\"; //database\n\nimport \"firebase/auth\"; //authentication\n\nconst config = {\n  apiKey: \"AIzaSyAKQUl3X_MsB--NC2mmBv1QDlkYedesjyM\",\n  authDomain: \"e-commerce-9e6dc.firebaseapp.com\",\n  databaseURL: \"https://e-commerce-9e6dc.firebaseio.com\",\n  projectId: \"e-commerce-9e6dc\",\n  storageBucket: \"e-commerce-9e6dc.appspot.com\",\n  messagingSenderId: \"215401701740\",\n  appId: \"1:215401701740:web:1c4078516bb4ba942f5349\",\n  measurementId: \"G-45QGGVYL1N\"\n};\nexport const createUserProfileDocument = async (userAuth, additionalData) => {\n  // 1. Return if user signed out (null)\n  if (!userAuth) return; // Use userAuth obj to query db for documentReference to user. uid is dynamically generated id that firestore created when user authenticated\n\n  const userRef = firestore.doc(`users/${userAuth.uid}`); // 2. Then use documentReference object to get snapShot object, which includes a boolean 'exists' property\n  //    Note: .get() returns a snapshot object which represents the data at that location in db,\n  //           which we can use to see if userAuth exists\n\n  const snapShot = await userRef.get(); // 3. If user doesn't exist, create new user inside userRef (within db).\n  //    Note: use document reference object (userRef) to do CRUD operations rather than snapshot\n\n  if (!snapShot.exists) {\n    const {\n      displayName,\n      email\n    } = userAuth;\n    const createdAt = new Date();\n\n    try {\n      await userRef.set({\n        displayName,\n        email,\n        createdAt,\n        ...additionalData\n      });\n    } catch (error) {\n      console.log(\"error creating user\", error.message);\n    }\n  }\n\n  return userRef;\n};\nfirebase.initializeApp(config); // Add collection (shop.collection) and document objects (shop data) to firestore\n\nexport const addCollectionAndDocuments = async (collectionKey, objectsToAdd) => {\n  const collectionRef = firestore.collection(collectionKey); // 1. Create firestore batch object\n\n  const batch = firestore.batch();\n  objectsToAdd.forEach(obj => {\n    // 2. Create a new documentReference object for each category in collection (i.e. hats). Firestore's .doc() method (without params) will generate random IDs which will also be used for url path\n    const newDocRef = collectionRef.doc(); // 3. Set the value (title and items) for each docRef object by batching .set() calls together.\n\n    batch.set(newDocRef, obj);\n  }); // Execute batch request, which returns a promise. When .commit() succeeds it will resolve a void (null) value\n\n  return await batch.commit();\n};\nexport const convertCollectionsSnapshotToMap = collections => {\n  // .docs gives us query snapshot, .data() gives us data, only need title and items\n  const transformedCollection = collections.docs.map(doc => {\n    const {\n      title,\n      items\n    } = doc.data(); // return object from back end that only includes data we need for front end\n    // routeName is a new property who's value will be the same string as title (ie hats). encodeURI - encodes URI by replacing characters that a URL cannot process.\n\n    return {\n      routeName: encodeURI(title.toLowerCase()),\n      id: doc.id,\n      title,\n      items\n    };\n  }); // Convert array of objects to new object. Reduce iterates through each collection in array (ie hats) and adds collection title to new object. It then sets the property value equal to the actual collection object --> hats: {routeName: 'hats', id: 123, etc.}\n\n  return transformedCollection.reduce((accumulator, collection) => {\n    accumulator[collection.title.toLowerCase()] = collection;\n    return accumulator;\n  }, {});\n};\nexport const auth = firebase.auth(); // we imported firebase/auth above which gives us access to .auth() method on firebase. Export for anything we need related to authentication\n\nexport const firestore = firebase.firestore(); // set up google authentication utility\n\nexport const googleProvider = new firebase.auth.GoogleAuthProvider(); // gives us access to googleAuthProvider class from auth library\n// triggers google popup when we use googleAuthProvider for authentication and sign-in\n\ngoogleProvider.setCustomParameters({\n  prompt: \"select_account\"\n}); // signInWithPopup contains popups for several services (sign in with twitter, facebook etc). We just want google\n\nexport const signInWithGoogle = () => auth.signInWithPopup(googleProvider); // export firebase as default in case we want entire library\n\nexport default firebase;","map":{"version":3,"sources":["/Users/matt_diamond/Documents/Lynda/udacity/_nano/Projects/crown-clothing/src/firebase/firebase.utils.js"],"names":["firebase","config","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","createUserProfileDocument","userAuth","additionalData","userRef","firestore","doc","uid","snapShot","get","exists","displayName","email","createdAt","Date","set","error","console","log","message","initializeApp","addCollectionAndDocuments","collectionKey","objectsToAdd","collectionRef","collection","batch","forEach","obj","newDocRef","commit","convertCollectionsSnapshotToMap","collections","transformedCollection","docs","map","title","items","data","routeName","encodeURI","toLowerCase","id","reduce","accumulator","auth","googleProvider","GoogleAuthProvider","setCustomParameters","prompt","signInWithGoogle","signInWithPopup"],"mappings":"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","sourcesContent":["import firebase from \"firebase/app\";\nimport \"firebase/firestore\"; //database\nimport \"firebase/auth\"; //authentication\n\nconst config = {\n  apiKey: \"AIzaSyAKQUl3X_MsB--NC2mmBv1QDlkYedesjyM\",\n  authDomain: \"e-commerce-9e6dc.firebaseapp.com\",\n  databaseURL: \"https://e-commerce-9e6dc.firebaseio.com\",\n  projectId: \"e-commerce-9e6dc\",\n  storageBucket: \"e-commerce-9e6dc.appspot.com\",\n  messagingSenderId: \"215401701740\",\n  appId: \"1:215401701740:web:1c4078516bb4ba942f5349\",\n  measurementId: \"G-45QGGVYL1N\"\n};\n\nexport const createUserProfileDocument = async (userAuth, additionalData) => {\n  // 1. Return if user signed out (null)\n  if (!userAuth) return;\n\n  // Use userAuth obj to query db for documentReference to user. uid is dynamically generated id that firestore created when user authenticated\n  const userRef = firestore.doc(`users/${userAuth.uid}`);\n\n  // 2. Then use documentReference object to get snapShot object, which includes a boolean 'exists' property\n  //    Note: .get() returns a snapshot object which represents the data at that location in db,\n  //           which we can use to see if userAuth exists\n  const snapShot = await userRef.get();\n\n  // 3. If user doesn't exist, create new user inside userRef (within db).\n  //    Note: use document reference object (userRef) to do CRUD operations rather than snapshot\n  if (!snapShot.exists) {\n    const { displayName, email } = userAuth;\n    const createdAt = new Date();\n\n    try {\n      await userRef.set({\n        displayName,\n        email,\n        createdAt,\n        ...additionalData\n      });\n    } catch (error) {\n      console.log(\"error creating user\", error.message);\n    }\n  }\n  return userRef;\n};\n\nfirebase.initializeApp(config);\n\n// Add collection (shop.collection) and document objects (shop data) to firestore\nexport const addCollectionAndDocuments = async (\n  collectionKey,\n  objectsToAdd\n) => {\n  const collectionRef = firestore.collection(collectionKey);\n\n  // 1. Create firestore batch object\n  const batch = firestore.batch();\n\n  objectsToAdd.forEach(obj => {\n    // 2. Create a new documentReference object for each category in collection (i.e. hats). Firestore's .doc() method (without params) will generate random IDs which will also be used for url path\n    const newDocRef = collectionRef.doc();\n    // 3. Set the value (title and items) for each docRef object by batching .set() calls together.\n    batch.set(newDocRef, obj);\n  });\n\n  // Execute batch request, which returns a promise. When .commit() succeeds it will resolve a void (null) value\n  return await batch.commit();\n};\n\nexport const convertCollectionsSnapshotToMap = collections => {\n  // .docs gives us query snapshot, .data() gives us data, only need title and items\n  const transformedCollection = collections.docs.map(doc => {\n    const { title, items } = doc.data();\n    // return object from back end that only includes data we need for front end\n    // routeName is a new property who's value will be the same string as title (ie hats). encodeURI - encodes URI by replacing characters that a URL cannot process.\n    return {\n      routeName: encodeURI(title.toLowerCase()),\n      id: doc.id,\n      title,\n      items\n    };\n  });\n  // Convert array of objects to new object. Reduce iterates through each collection in array (ie hats) and adds collection title to new object. It then sets the property value equal to the actual collection object --> hats: {routeName: 'hats', id: 123, etc.}\n  return transformedCollection.reduce((accumulator, collection) => {\n    accumulator[collection.title.toLowerCase()] = collection;\n    return accumulator;\n  }, {});\n};\n\nexport const auth = firebase.auth(); // we imported firebase/auth above which gives us access to .auth() method on firebase. Export for anything we need related to authentication\nexport const firestore = firebase.firestore();\n\n// set up google authentication utility\nexport const googleProvider = new firebase.auth.GoogleAuthProvider(); // gives us access to googleAuthProvider class from auth library\n// triggers google popup when we use googleAuthProvider for authentication and sign-in\ngoogleProvider.setCustomParameters({ prompt: \"select_account\" });\n// signInWithPopup contains popups for several services (sign in with twitter, facebook etc). We just want google\nexport const signInWithGoogle = () => auth.signInWithPopup(googleProvider);\n// export firebase as default in case we want entire library\nexport default firebase;\n"]},"metadata":{},"sourceType":"module"}